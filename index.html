<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TokenDrip</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#fff;
  --primary:#00bcd4;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding-bottom:env(safe-area-inset-bottom);
}
.container{max-width:600px;margin:auto;padding:16px}
.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:var(--primary);
  color:#000;
  font-size:1rem;
  cursor:pointer;
}
.stat{margin-top:6px}
.progress{
  height:10px;
  background:#333;
  border-radius:6px;
  overflow:hidden;
  margin-top:8px;
}
.bar{height:100%;background:var(--primary)}
.small{font-size:.9rem;word-break:break-all}
</style>
</head>

<body>
<div class="container">

  <!-- Ø§Ù„Ø±ØµÙŠØ¯ -->
  <div class="card">
    <h3>ğŸ’° Ø±ØµÙŠØ¯Ùƒ</h3>
    <div id="balance">0.0000 $</div>
  </div>

  <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
  <div class="card">
    <h3>â­ Ù…Ø³ØªÙˆØ§Ùƒ</h3>
    <div class="stat">Level: <b id="level">1</b></div>
    <div class="stat">XP: <b id="xp">0</b></div>
    <div class="progress"><div id="xpBar" class="bar"></div></div>
  </div>

  <!-- Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª -->
  <div class="card">
    <h3>ğŸ¤ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</h3>
    <div class="stat">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª: <b id="refCount">0</b></div>
    <div class="stat">ØªÙ…Øª Ø¯Ø¹ÙˆØªÙƒ Ø¨ÙˆØ§Ø³Ø·Ø©: <b id="invitedBy">â€”</b></div>
  </div>

  <!-- Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© -->
  <div class="card">
    <h3>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h3>
    <div id="refLink" class="small"></div>
    <button onclick="copyRef()">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
  </div>

  <!-- ØªØ¹Ø¯ÙŠÙ† (ØªØ¬Ø±ÙŠØ¨ÙŠ) -->
  <div class="card">
    <h3>â›ï¸ ØªØ¹Ø¯ÙŠÙ† (ØªØ¬Ø±ÙŠØ¨ÙŠ)</h3>
    <button onclick="mine()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ø¯ÙŠÙ†</button>
  </div>

</div>

<script>
const tg = Telegram.WebApp;
tg.ready(); tg.expand();

const SERVER = "https://steep-resonance-6443.alaabdalaziz01.workers.dev";
const BOT_USERNAME = "TokenDrip_bot";

let USER = null;

// Ù†Ù‚Ø±Ø£ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
const params = new URLSearchParams(window.location.search);
const refFromUrl = params.get("startapp");

async function api(action, payload = {}) {
  const r = await fetch(SERVER,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      initData: tg.initData,
      action,
      payload
    })
  });
  return r.json();
}

async function load(){
  const d = await api("login",{ ref: refFromUrl });
  USER = d.user;
  render();
}

function render(){
  balance.innerText = USER.balance.toFixed(4)+" $";
  level.innerText = USER.level;
  xp.innerText = USER.xp || 0;
  refCount.innerText = USER.refCount || 0;
  invitedBy.innerText = USER.invitedBy || "â€”";

  const xpReq = [0,10,25,45,70,100,140,190,250,320];
  const next = xpReq[USER.level] || USER.xp;
  const percent = next ? Math.min(USER.xp/next*100,100) : 100;
  xpBar.style.width = percent+"%";

  refLink.innerText =
    `https://t.me/${BOT_USERNAME}?start=${USER.id}`;
}

function copyRef(){
  navigator.clipboard.writeText(refLink.innerText);
  alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©");
}

// ØªØ¹Ø¯ÙŠÙ† ØªØ¬Ø±ÙŠØ¨ÙŠ (Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§)
async function mine(){
  alert("Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø¨Ø­ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©");
}

load();
</script>
</body>
</html>
