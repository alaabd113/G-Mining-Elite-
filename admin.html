<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TokenDrip</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
  --bg:#121212;
  --card:#1e1e1e;
  --text:#ffffff;
  --primary:#00bcd4;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding-bottom:env(safe-area-inset-bottom);
}
.container{max-width:600px;margin:auto;padding:16px}
.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:var(--primary);
  color:#000;
  font-size:1rem;
}
.small{font-size:.9rem;word-break:break-all}
.stat{margin-top:6px;font-size:1.05rem}
.progress{
  height:10px;
  background:#333;
  border-radius:6px;
  overflow:hidden;
  margin-top:8px;
}
.bar{
  height:100%;
  background:var(--primary);
}
</style>
</head>

<body>
<div class="container">

  <div class="card">
    <h3>ğŸ’° Ø±ØµÙŠØ¯Ùƒ</h3>
    <div id="balance">0.0000 $</div>
  </div>

  <div class="card">
    <h3>â­ Ù…Ø³ØªÙˆØ§Ùƒ</h3>
    <div class="stat">Level: <b id="level">1</b></div>
    <div class="stat">XP: <b id="xp">0</b></div>
    <div class="progress">
      <div id="xpBar" class="bar"></div>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ¤ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</h3>
    <div class="stat">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª: <b id="refCount">0</b></div>
    <div class="stat">ØªÙ…Øª Ø¯Ø¹ÙˆØªÙƒ Ø¨ÙˆØ§Ø³Ø·Ø©: <b id="invitedBy">â€”</b></div>
  </div>

  <div class="card">
    <h3>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h3>
    <div id="refLink" class="small"></div>
    <button onclick="copyRef()">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
  </div>

</div>

<script>
const tg = Telegram.WebApp;
tg.ready(); tg.expand();

const SERVER = "https://steep-resonance-6443.alaabdalaziz01.workers.dev";
const BOT_USERNAME = "TokenDrip_bot";

let USER = null;

async function api(action, payload = {}) {
  const r = await fetch(SERVER, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      initData: tg.initData,
      action,
      payload
    })
  });
  return r.json();
}

async function load() {
  const ref = tg.initDataUnsafe?.start_param || null;
  const d = await api("login", { ref });
  USER = d.user;
  render();
}

function render() {
  document.getElementById("balance").innerText =
    USER.balance.toFixed(4) + " $";

  document.getElementById("refCount").innerText =
    USER.refCount || 0;

  document.getElementById("invitedBy").innerText =
    USER.invitedBy ? USER.invitedBy : "â€”";

  document.getElementById("level").innerText = USER.level;
  document.getElementById("xp").innerText = USER.xp || 0;

  const nextXp = USER.level < 10
    ? [0,10,25,45,70,100,140,190,250,320][USER.level] 
    : USER.xp;

  const percent = nextXp
    ? Math.min((USER.xp / nextXp) * 100, 100)
    : 100;

  document.getElementById("xpBar").style.width = percent + "%";

  const link = `https://t.me/${BOT_USERNAME}?start=${USER.id}`;
  document.getElementById("refLink").innerText = link;
}

function copyRef() {
  navigator.clipboard.writeText(
    document.getElementById("refLink").innerText
  );
  alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©");
}

load();
</script>
</body>
</html>
