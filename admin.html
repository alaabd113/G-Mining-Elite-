<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
  --bg:#1e1e1e;
  --card:rgba(255,255,255,.05);
  --text:#fff;
  --primary:#2196f3;
  --success:#4caf50;
}

* { box-sizing:border-box; font-family:system-ui }

html,body { height:100%; margin:0 }

body {
  background:var(--bg);
  color:var(--text);
  padding-bottom:env(safe-area-inset-bottom);
}

.container { max-width:600px; margin:auto; padding:16px }
.card {
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}

input,select,button {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:none;
}

button { cursor:pointer }
.primary { background:var(--primary); color:#fff }
.success { background:var(--success); color:#fff }

.toast {
  position:fixed;
  bottom:20px;
  right:20px;
  background:#000;
  color:#fff;
  padding:10px 16px;
  border-radius:8px;
}
</style>
</head>

<body>
<div class="container">

<h2>⚙️ لوحة تحكم الأدمن</h2>

<div class="card">
  <input id="userId" placeholder="User ID">
  <input id="balance" type="number" step="0.01" placeholder="Add Balance">
  <select id="vip">
    <option value="0">FREE</option>
    <option value="1">BASIC</option>
    <option value="2">PRO</option>
    <option value="3">ELITE</option>
  </select>
  <button class="primary" onclick="updateUser()">تحديث المستخدم</button>
</div>

<div class="card">
  <input id="wkey" placeholder="Withdraw Key">
  <button class="success" onclick="approve()">اعتماد السحب</button>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
const SERVER = "https://steep-resonance-6443.alaabdalaziz01.workers.dev";

if (!tg?.initDataUnsafe?.user) {
  document.body.innerHTML = "❌ ACCESS DENIED";
  throw new Error("Not Telegram");
}

tg.ready();
tg.expand();

document.documentElement.style.setProperty(
  "--bg",
  tg.themeParams.bg_color || "#1e1e1e"
);

function toast(msg) {
  const t=document.createElement("div");
  t.className="toast";
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3000);
}

async function api(payload) {
  const r = await fetch(SERVER,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      initData:tg.initData,
      action:"admin_action",
      payload
    })
  });
  return r.json();
}

async function updateUser() {
  const d = await api({
    targetId:+userId.value,
    addBal:+balance.value,
    setVip:+vip.value
  });
  toast(d.ok?"تم":"خطأ");
}

async function approve() {
  const d = await api({ approveKey:wkey.value });
  toast(d.ok?"تم":"خطأ");
}
</script>
</body>
</html>
