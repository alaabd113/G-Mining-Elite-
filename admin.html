<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Control Center</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/vant@4/lib/index.css" />
  <script src="https://unpkg.com/vant@4/lib/vant.min.js"></script>
  
  <style>
    body { background: #0f0f0f; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 15px; }
    .admin-card { background: #1a1a1a; border-radius: 12px; padding: 20px; border: 1px solid #333; margin-bottom: 20px; }
    .section-title { color: #FFD700; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
    .status-badge { font-size: 12px; padding: 2px 8px; border-radius: 4px; background: #333; color: #aaa; }
    input { background: #222 !important; border: 1px solid #444 !important; color: #fff !important; }
    .van-button--primary { background: #FFD700; border: none; color: #000; font-weight: bold; }
    .van-button--warning { background: #ff9800; border: none; }
  </style>
</head>
<body>

<div id="app">
  <div v-if="!isAdmin" style="text-align:center; padding-top: 50px;">
    <van-icon name="lock" size="50" color="#ff4444"></van-icon>
    <h3>Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„</h3>
  </div>

  <div v-else>
    <h2 style="text-align: center; color: #FFD700;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>

    <div class="admin-card">
      <div class="section-title">ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø±ØµÙŠØ¯ ÙˆØ±ØªØ¨Ø© Ù…Ø³ØªØ®Ø¯Ù…</div>
      <van-cell-group inset>
        <van-field v-model="form.userId" label="ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" placeholder="Ù…Ø«Ø§Ù„: 921301895" type="digit"></van-field>
        <van-field v-model="form.addBalance" label="Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯" placeholder="0.00" type="number"></van-field>
        <van-field v-model="form.setVip" label="ØªØ¹Ø¯ÙŠÙ„ VIP" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„" type="digit"></van-field>
      </van-cell-group>
      <div style="margin: 16px 0;">
        <van-button block type="primary" :loading="loading" @click="confirmUpdate">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</van-button>
      </div>
    </div>

    <div class="admin-card">
      <div class="section-title">ğŸ’° Ø§Ø¹ØªÙ…Ø§Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</div>
      <van-field v-model="form.wKey" label="Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø­Ø¨" placeholder="Ø§Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…"></van-field>
      <div style="margin: 16px 0;">
        <van-button block type="warning" :loading="loading" @click="confirmApprove">Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ¥Ø¸Ù‡Ø§Ø± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· âœ…</van-button>
      </div>
      <p style="font-size: 11px; color: #888;">* Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠÙ‚ÙˆÙ… Ø¨ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨ ÙˆØªØ³Ø¬ÙŠÙ„Ù‡ ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¹Ø§Ù….</p>
    </div>
  </div>
</div>

<script>
const { createApp, ref, onMounted } = Vue;
const { showToast, showConfirmDialog, showLoadingToast, closeToast } = vant;

// Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù€ Worker)
const ADMIN_ID = 921301895; 
const SERVER = "https://YOUR_WORKER.workers.dev"; // Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø±Ø§Ø¨Ø·Ùƒ

createApp({
  setup() {
    const tg = window.Telegram.WebApp;
    const isAdmin = ref(false);
    const loading = ref(false);
    const form = ref({
      userId: '',
      addBalance: '',
      setVip: '',
      wKey: ''
    });

    onMounted(() => {
      tg.ready();
      tg.expand();
      // ØªØ­Ù‚Ù‚ Ø£ÙˆÙ„ÙŠ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©
      if (tg.initDataUnsafe?.user?.id === ADMIN_ID) {
        isAdmin.value = true;
      }
    });

    const apiCall = async (payload) => {
      loading.value = true;
      const toast = showLoadingToast({ message: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...', forbidClick: true });

      try {
        const res = await fetch(SERVER, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            initData: tg.initData,
            action: "admin_action",
            payload: payload
          })
        });
        const d = await res.json();
        closeToast();

        if (d.ok) {
          showToast({ type: 'success', message: 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­' });
          return true;
        } else {
          showToast({ type: 'fail', message: d.error || 'ÙØ´Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©' });
          return false;
        }
      } catch (e) {
        closeToast();
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
        return false;
      } finally {
        loading.value = false;
      }
    };

    const confirmUpdate = () => {
      if (!form.value.userId) return showToast('Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
      
      showConfirmDialog({
        title: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«',
        message: `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${form.value.userId}ØŸ`,
      }).then(async () => {
        const payload = { targetId: Number(form.value.userId) };
        if (form.value.addBalance !== '') payload.addBalance = Number(form.value.addBalance);
        if (form.value.setVip !== '') payload.setVip = Number(form.value.setVip);
        
        const success = await apiCall(payload);
        if (success) {
          form.value.addBalance = '';
          form.value.setVip = '';
        }
      });
    };

    const confirmApprove = () => {
      if (!form.value.wKey) return showToast('Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø­Ø¨');

      showConfirmDialog({
        title: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨',
        message: 'Ù‡Ù„ ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙˆØªØ±ÙŠØ¯ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡ Ø§Ù„Ø¢Ù†ØŸ',
      }).then(async () => {
        await apiCall({ approveWithdrawKey: form.value.wKey });
      });
    };

    return { isAdmin, loading, form, confirmUpdate, confirmApprove };
  }
}).use(vant).mount("#app");
</script>
</body>
</html>
